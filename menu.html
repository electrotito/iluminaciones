<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Menú</title>
  <link rel="icon" href="img/yasy.jpeg">

  <link href="menu/styles.css" rel="stylesheet" />
  <link rel="stylesheet" href="bt-icons/bootstrap-icons.min.css">
  <link rel="stylesheet" href="alert/alertify.min.css">
  <link rel="stylesheet" href="alert/themes/default.min.css">
  <!-- Animate.css para animaciones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <script src="alert/alertify.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e0e7ef 100%);
      min-height: 100vh;
    }
    .navbar-brand {
      font-weight: bold;
      letter-spacing: 1px;
    }
    .sb-sidenav-menu.bg-warning {
      background: linear-gradient(135deg, #fffbe6 0%, #ffe082 100%) !important;
    }
    .sb-sidenav-footer {
      border-top: 1px solid #e0e0e0;
    }
    .card {
      border-radius: 1rem;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.10);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
    }
    .btn-primary, .btn-success, .btn-danger, .btn-warning {
      transition: transform 0.2s;
    }
    .btn-primary:hover, .btn-success:hover, .btn-danger:hover, .btn-warning:hover {
      transform: scale(1.07);
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }
    .modal-content {
      border-radius: 1rem;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    }
  </style>
</head>
<body class="sb-nav-fixed">
  <nav class="sb-topnav navbar navbar-expand navbar-dark bg-primary shadow animate__animated animate__fadeInDown">
    <a class="navbar-brand ps-3" href="">ILUMINACIONES ELECTROTITO</a>
    <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="bi bi-list"></i></button>
    <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0"></form>
    <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-person-fill"></i></a>
        <ul class="dropdown-menu dropdown-menu-end animate__animated animate__fadeIn" aria-labelledby="navbarDropdown">
          <li><a class="dropdown-item" href="#!"><i class="bi bi-gear"></i> Config.</a></li>
          <li><a class="dropdown-item" href="#" onclick="edit_idusuario()" data-bs-toggle="modal" data-bs-target="#modalEditarUsuario"><i class="bi bi-pencil-square"></i> Editar Usuario</a></li>
          <li><hr class="dropdown-divider" /></li>
          <li><a class="dropdown-item" href="#" onclick="cerrarSesion()"><i class="bi bi-box-arrow-right"></i> Cerrar sesión</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <div id="layoutSidenav">
    <div id="layoutSidenav_nav">
      <nav class="sb-sidenav accordion sb-sidenav-ligth text-dark text fw-bold" id="sidenavAccordion">
        <div class="sb-sidenav-menu bg-warning">
          <div class="nav">
            <div class="sb-sidenav-menu-heading">Fecha/Hora</div>
            <a class="nav-link" href="menu.html">
              <div class="sb-nav-link-icon"><i class="bi bi-clock"></i></div>
              <span id="datetime"></span>
            </a>
            <div class="sb-sidenav-menu-heading">Secciones</div>
            <a class="nav-link collapsed text-dark" href="#" data-bs-toggle="collapse" data-bs-target="#collapseLayouts" aria-expanded="false" aria-controls="collapseLayouts">
              <div class="sb-nav-link-icon"><i class="bi bi-columns-gap"></i></div>
              Mantenimiento
              <div class="sb-sidenav-collapse-arrow"><i class="i bi-chevron-down"></i></div>
            </a>
            <div class="collapse" id="collapseLayouts" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
              <nav class="sb-sidenav-menu-nested nav">
                <a class="nav-link d-none" href="usuarios.html" id="Usuarios"><i class="bi bi-people"></i> Usuarios</a>
                <a class="nav-link d-none" href="articulos.html" id="Articulos"><i class="bi bi-box-seam"></i> Artículos</a>
                <a class="nav-link d-none" href="marcas.html" id="Marcas"><i class="bi bi-tags"></i> Marcas</a>
                <a class="nav-link d-none" href="clasificaciones.html" id="Familias"><i class="bi bi-list-ul"></i> Clasificaciones</a>
              </nav>
            </div>
            <hr>
    <div class="text-center mb-2">
      <button class="btn btn-danger w-100 animate__animated animate__pulse"
        style="font-weight:bold; letter-spacing:1px;"
        onclick="reiniciarDatosArticulos()">
        <i class="bi bi-arrow-clockwise"></i> Reiniciar datos
      </button>
      <small class="text-muted d-block mt-1" style="font-size:0.85em;">
        Restaura los datos de ejemplo<br>de artículos, marcas y clasificaciones.
      </small>
    </div>
          </div>
        </div>
        <div class="sb-sidenav-footer bg-dark text-white">
          <div class="small">Iniciado por:</div>
          <div id="usuario"></div>
        </div>
      </nav>
    </div>

    <div id="layoutSidenav_content">
      <main>
        <div class="container-fluid px-4">
          <h1 class="mt-4 animate__animated animate__fadeInDown text-primary fw-bold">BIENVENIDO</h1>
          <ol class="breadcrumb mb-4 animate__animated animate__fadeInLeft">
            <li class="breadcrumb-item active"></li>
          </ol>
          <!-- AQUÍ VA TODO LO QUE SE VA A VISUALIZAR EN LA PÁGINA -->
          <div class="row">
            <!-- Aquí puedes agregar tarjetas o widgets con animaciones si lo deseas -->
            <div class="col-md-4 mb-4">
              <div class="card animate__animated animate__zoomIn">
                <div class="card-body text-center">
                  <i class="bi bi-people display-4 text-primary"></i>
                  <h5 class="card-title mt-2">Usuarios</h5>
                  <a href="usuarios.html" class="btn btn-outline-primary mt-2">Ver Usuarios</a>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-4">
              <div class="card animate__animated animate__zoomIn animate__delay-1s">
                <div class="card-body text-center">
                  <i class="bi bi-box-seam display-4 text-success"></i>
                  <h5 class="card-title mt-2">Artículos</h5>
                  <a href="articulos.html" class="btn btn-outline-success mt-2">Ver Artículos</a>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-4">
              <div class="card animate__animated animate__zoomIn animate__delay-2s">
                <div class="card-body text-center">
                  <i class="bi bi-tags display-4 text-warning"></i>
                  <h5 class="card-title mt-2">Marcas</h5>
                  <a href="marcas.html" class="btn btn-outline-warning mt-2">Ver Marcas</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  
  <!-- Modal Editar Usuario -->
  <div class="modal fade" id="modalEditarUsuario" tabindex="-1" aria-labelledby="modalEditarUsuarioLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog animate__animated animate__zoomIn">
      <form id="formEditarUsuario" class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="modalEditarUsuarioLabel"><i class="bi bi-pencil-square"></i> Editar Usuario</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="edit_idusuario">
          <div class="mb-2">
            <label class="form-label">N° Cédula</label>
            <input type="number" id="edit_cedula" readonly class="form-control" required min="1000000" max="9999999">
          </div>
          <div class="mb-2">
            <label class="form-label">Nombre completo</label>
            <input type="text" id="edit_nombre" readonly class="form-control text-uppercase" required minlength="6" maxlength="50">
          </div>
          <div class="mb-2">
            <label class="form-label">Celular</label>
            <input type="text" id="edit_celular" readonly class="form-control" required minlength="6" maxlength="12">
          </div>
          <div class="mb-2">
            <label class="form-label">Usuario</label>
            <input type="text" id="edit_usuario" class="form-control" required minlength="5" maxlength="30">
          </div>
          <div class="mb-2">
            <label class="form-label">Contraseña</label>
            <input type="password" id="edit_contrasena" class="form-control" required minlength="5" maxlength="30">
          </div>
          <div class="mb-2">
            <label class="form-label">Confirmar</label>
            <input type="password" id="edit_c-contrasena" class="form-control" required minlength="5" maxlength="30">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cancelar</button>
          <button type="submit" class="btn btn-success"><i class="bi bi-check-circle"></i> Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Importar el archivo JavaScript -->
  <script src="js/menu.js"></script>
  <script src="js/bdP.js"></script>
  <script src="js/sistemFunctions.js"></script>
  <script src="menu/bootstrap.bundle.min.js"></script>
  <script src="menu/scripts.js"></script>

  <script>
    if(!sessionStorage.getItem("sesionActiva")){
      localStorage.removeItem("nomUsuario");
      localStorage.removeItem("rolUsuario");
      window.location.href = "Pagerror.html";
    }
    
    var nom = localStorage.getItem("nomUsuario");
    if (nom == "" || nom == null){
      window.location.href = "Pagerror.html";
    }else{
      document.getElementById("usuario").innerHTML = nom;
    }
  </script>

  <script>
    var usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    var cargo = localStorage.getItem("rolUsuario");
    if(cargo==="Administrador"){
      document.getElementById("Usuarios").classList.remove('d-none');
      document.getElementById("Marcas").classList.remove('d-none');
      document.getElementById("Familias").classList.remove('d-none');
      document.getElementById("Articulos").classList.remove('d-none');
    }
  </script>

  <script>
    function edit_idusuario() {
        const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
        const nomUsuario = localStorage.getItem('nomUsuario');
        const usuarioActual = usuarios.find(u => u.nombre === nomUsuario);

        if (usuarioActual) {
            document.getElementById('edit_idusuario').value = usuarioActual.idusuario;
            document.getElementById('edit_cedula').value = usuarioActual.cedula;
            document.getElementById('edit_nombre').value = usuarioActual.nombre;
            document.getElementById('edit_celular').value = usuarioActual.celular;
            document.getElementById('edit_usuario').value = usuarioActual.usuario;
            document.getElementById('edit_contrasena').value = usuarioActual.contrasena;
        } else {
            alertify.error('Usuario no encontrado.');
        }
    }

    document.getElementById('formEditarUsuario').addEventListener('submit', function (e) {
      e.preventDefault();
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      const idUsuario = parseInt(document.getElementById('edit_idusuario').value);
      const index = usuarios.findIndex(u => u.idusuario === idUsuario);

      if (index !== -1) {
        usuarios[index].usuario = document.getElementById('edit_usuario').value.trim();
        usuarios[index].contrasena = document.getElementById('edit_contrasena').value.trim();

        const nuevoUsuarioNombre = document.getElementById('edit_usuario').value.trim();
        const existeUsuario = usuarios.some((u, i) =>
          u.usuario === nuevoUsuarioNombre && i !== index
        );
        if (existeUsuario) {
          alertify.error('Ya existe un usuario con ese nombre');
          return;
        }
        const contrasena = document.getElementById('edit_contrasena').value.trim();
        const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,}$/;
        if (!regex.test(contrasena)) {
          alertify.error("La contraseña debe tener al menos 8 caracteres, incluyendo 2 mayúsculas, 2 minúsculas y 2 números");
          return;
        }
        if(usuarios[index].contrasena !== document.getElementById('edit_c-contrasena').value.trim()) {
          alertify.error("Las contraseñas no coinciden");
          return;
        }else{       
          localStorage.setItem('usuarios', JSON.stringify(usuarios));
          localStorage.setItem('nomUsuario', usuarios[index].nombre);
        }
        document.getElementById('usuario').innerHTML = usuarios[index].nombre;
        const modalEditarUsuario = bootstrap.Modal.getInstance(document.getElementById('modalEditarUsuario'));
        modalEditarUsuario.hide();
        alertify.success('Usuario actualizado correctamente.');
      } else {
        alertify.error('No se pudo actualizar el usuario.');
      }
    });

    // ...existing code...
function cerrarSesion() {
  alertify.confirm("Cerrar sesión", "¿Estás seguro de que deseas cerrar sesión?",
    function () {
      sessionStorage.removeItem("sesionActiva");
      localStorage.removeItem("nomUsuario");
      localStorage.removeItem("rolUsuario");
      window.location.href = "index.html";
    },
    function () {
      alertify.error("Cancelado");
    }
  ).set('labels', { ok: 'Sí', cancel: 'No' });
}
// ...existing code...

    function updateDateTime() {
      const now = new Date(); 
      const formatted = now.toLocaleString();
      document.getElementById("datetime").textContent = formatted;
    }
    updateDateTime();
    setInterval(updateDateTime, 1000);


  </script>
</body>
</html>